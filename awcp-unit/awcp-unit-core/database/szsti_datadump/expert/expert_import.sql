#删除重复的专家数据（如果ID相同，这保留ID最大的专家ID）DELETE FROM p_un_user_base_info WHERE  GROUP_ID = 4 AND USER_ID_CARD_NUMBER IN(SELECT  USER_ID_CARD_NUMBER FROM( SELECT USER_ID_CARD_NUMBER, MIN(USER_ID),COUNT(1) FROM p_un_user_base_infoWHERE GROUP_ID=4GROUP BY USER_ID_CARD_NUMBER HAVING COUNT(1) >1ORDER BY COUNT(1) DESC) AS b)AND USER_ID NOT IN(SELECT  USER_ID FROM( SELECT USER_ID_CARD_NUMBER, MIN(USER_ID) AS USER_ID,COUNT(1) FROM p_un_user_base_infoWHERE GROUP_ID=4GROUP BY USER_ID_CARD_NUMBER HAVING COUNT(1) >1ORDER BY COUNT(1) DESC) AS b);#格式化政治密码数据UPDATE temp_expert_base_infoSET POLITICAL = '中共党员'WHERE POLITICAL = '党员';#格式化单位职务UPDATE temp_expert_base_infoSET TITLE = '高级工程师'WHERE TITLE LIKE '%高级工程师%'AND TITLE != '高级工程师'AND TITLE != '教授级高级工程师';UPDATE temp_expert_base_infoSET TITLE = '教授级高级工程师'WHERE TITLE IN( '教授级高工','教授级高级工程、国务院特殊津贴');UPDATE temp_expert_base_infoSET TITLE = '高级工程师'WHERE TITLE IN( '高级制药工程师','高经工程师','高工，副研','高工，副研');UPDATE temp_expert_base_infoSET TITLE = '副教授'WHERE TITLE IN('副教授、系统分析师','副教授/副系主任' ,'副教授、高级技师','副教授/博导','副教艘','副教授，高级实验师');UPDATE temp_expert_base_infoSET TITLE = '教授'WHERE TITLE IN('  教授','教授，博导','教授、研究员、医学影像研究中心主任','教授/主任医师','副主任、教授','教授（博导）','研究员、教授','教授、研究生导师','主任技师/教授','特聘教授','讲座教授','教授、主任医师','主任医师、教授、博士生导师','教授，主任医师','教授/博导','教授 主任医师','教授、博导、留英博士','二级教授','教授、博导','主任医师、教授','教授（2级）','中科院院士、教授','教授(2011) （主治医师-1991）','主任技师、教授','教授、主任医师、博导','研究员（教授）');UPDATE temp_expert_base_infoSET TITLE = '助教'WHERE TITLE IN('助理教授, 博士生导师','助理教授','助授');UPDATE temp_expert_base_infoSET TITLE = '主任医师'WHERE TITLE IN ('主任医师/研究员','主任医师，教授','主任医师/副教授','口腔主任医师','主任医师、副教授','正高（主任医师）','主任中医师','眼科主任医师','中医眼科主任中医师','教授、博士生导师','主任医师，副教授','主任医师 教授','主管医师','感染性疾病科主任医师','血液科主任医师','主任医院师');UPDATE temp_expert_base_infoSET TITLE = '副主任医师'WHERE TITLE IN ('职业卫生副主任医师','副主任医生');UPDATE temp_expert_base_infoSET TITLE = '副主任技师'WHERE TITLE IN ('临床医学检验副主任技师');UPDATE temp_expert_base_infoSET TITLE = '主任药师'WHERE TITLE IN('主任中药师','主管药师');UPDATE temp_expert_base_infoSET TITLE = '研究员'WHERE TITLE IN('研究员（三级）','研究员、博导','园艺研究员','总经理、研究员','正研究员','医学研究员','博导研究员','项目研究员','特聘研究员');UPDATE temp_expert_base_infoSET TITLE = '助理研究员'WHERE TITLE IN('助研','助理研究员（中级）');UPDATE temp_expert_base_infoSET TITLE = '副研究员'WHERE TITLE IN('副研究員','副研');UPDATE temp_expert_base_infoSET TITLE = '主任技师'WHERE TITLE IN('主任检验技师');UPDATE temp_expert_base_infoSET TITLE = '经济师'WHERE TITLE IN('中级经济师','工程师，经济师','中级工程师');UPDATE temp_expert_base_infoSET TITLE = '工程师'WHERE TITLE IN('中级工程师、政工师、','工程师一级','中级');UPDATE temp_expert_base_infoSET TITLE = '高级工程师'WHERE TITLE IN('高级注塑工程师','高级','高工','信息系统项目管理师（高级）');UPDATE temp_expert_base_infoSET TITLE = '实验师'WHERE TITLE IN('实验室主任');UPDATE temp_expert_base_infoSET TITLE = '会计师'WHERE TITLE IN('注册会计师');UPDATE temp_expert_base_infoSET TITLE = '博士生'WHERE TITLE IN('博士');#格式化最高学历UPDATE temp_expert_base_infoSET EDUCATION = '本科'WHERE EDUCATION = '学士';UPDATE temp_expert_base_infoSET EDUCATION = '博士'WHERE EDUCATION IN( '博士后',' 博士');#MAJOR_FIRST_TECH_DISCIPLINEUPDATE temp_expert_base_infoSET MAJOR_FIRST_TECH_DISCIPLINE = '管理科学与工程'WHERE MAJOR_FIRST_TECH_DISCIPLINE = '☆管理科学与工程';UPDATE temp_expert_base_infoSET MAJOR_FIRST_TECH_DISCIPLINE = '生物医学工程'WHERE MAJOR_FIRST_TECH_DISCIPLINE = '☆生物医学工程';UPDATE temp_expert_base_infoSET MAJOR_FIRST_TECH_DISCIPLINE = '光学工程'WHERE MAJOR_FIRST_TECH_DISCIPLINE = '☆光学工程';UPDATE temp_expert_base_infoSET MAJOR_FIRST_TECH_DISCIPLINE = '仪器科学与技术'WHERE MAJOR_FIRST_TECH_DISCIPLINE = '仪器科学';#SECONDARY_FIRST_TECH_DISCIPLINEUPDATE temp_expert_base_infoSET SECONDARY_FIRST_TECH_DISCIPLINE = '管理科学与工程'WHERE SECONDARY_FIRST_TECH_DISCIPLINE = '☆管理科学与工程';UPDATE temp_expert_base_infoSET SECONDARY_FIRST_TECH_DISCIPLINE = '生物医学工程'WHERE SECONDARY_FIRST_TECH_DISCIPLINE = '☆生物医学工程';UPDATE temp_expert_base_infoSET SECONDARY_FIRST_TECH_DISCIPLINE = '光学工程'WHERE SECONDARY_FIRST_TECH_DISCIPLINE = '☆光学工程';UPDATE temp_expert_base_infoSET SECONDARY_FIRST_TECH_DISCIPLINE = '仪器科学与技术'WHERE SECONDARY_FIRST_TECH_DISCIPLINE = '仪器科学';#MAJOR_SECOND_TECH_DISCIPLINEUPDATE temp_expert_base_infoSET MAJOR_SECOND_TECH_DISCIPLINE = '管理科学与工程'WHERE MAJOR_SECOND_TECH_DISCIPLINE = '☆管理科学与工程';UPDATE temp_expert_base_infoSET MAJOR_SECOND_TECH_DISCIPLINE = '生物医学工程'WHERE MAJOR_SECOND_TECH_DISCIPLINE = '☆生物医学工程';UPDATE temp_expert_base_infoSET MAJOR_SECOND_TECH_DISCIPLINE = '光学工程'WHERE MAJOR_SECOND_TECH_DISCIPLINE = '☆光学工程';#SECONDARY_SECOND_TECH_DISCIPLINEUPDATE temp_expert_base_infoSET SECONDARY_SECOND_TECH_DISCIPLINE = '管理科学与工程'WHERE SECONDARY_SECOND_TECH_DISCIPLINE = '☆管理科学与工程';UPDATE temp_expert_base_infoSET SECONDARY_SECOND_TECH_DISCIPLINE = '生物医学工程'WHERE SECONDARY_SECOND_TECH_DISCIPLINE = '☆生物医学工程';UPDATE temp_expert_base_infoSET SECONDARY_SECOND_TECH_DISCIPLINE = '光学工程'WHERE SECONDARY_SECOND_TECH_DISCIPLINE = '☆光学工程';UPDATE temp_expert_base_infoSET MAJOR_SECOND_TECH_DISCIPLINE = '企业管理'WHERE MAJOR_SECOND_TECH_DISCIPLINE = '企业管理（含：财务管理、市场营销、人力资源管理）';UPDATE temp_expert_base_infoSET SECONDARY_SECOND_TECH_DISCIPLINE = '企业管理'WHERE SECONDARY_SECOND_TECH_DISCIPLINE = '企业管理（含：财务管理、市场营销、人力资源管理）';#格式化专家教育的学位信息;UPDATE temp_expert_edu_experienceSET DEGREE = '学士'WHERE (DEGREE LIKE '%学士%'  AND DEGREE != '学士') OR DEGREE IN('本科','學士');UPDATE temp_expert_edu_experienceSET DEGREE = '博士'WHERE (DEGREE LIKE '%博士%' AND DEGREE != '博士') OR DEGREE IN('PhD', 'Ph.D.');UPDATE temp_expert_edu_experienceSET DEGREE = '硕士'WHERE DEGREE LIKE '%硕士%' AND DEGREE != '硕士' OR DEGREE IN('研究生','碩士','Master','研究生班','MBA');#清楚重复的DATA;DELETE FROM expert_base_info WHERE ID IN (SELECT ID FROM temp_expert_base_info);DELETE FROM expert_edu_experience WHERE ID IN (SELECT ID FROM temp_expert_edu_experience);DELETE FROM expert_patent WHERE ID IN (SELECT ID FROM temp_expert_patent);DELETE FROM expert_position WHERE ID IN (SELECT ID FROM temp_expert_position);DELETE FROM expert_project_info WHERE ID IN (SELECT ID FROM temp_expert_project_info);DELETE FROM expert_represent_papers WHERE ID IN (SELECT ID FROM temp_expert_represent_papers);DELETE FROM expert_work_experience WHERE ID IN (SELECT ID FROM temp_expert_work_experience);#插入专家基础数据INSERT  INTO expert_base_info(ID,USER_ID, NAME, SEX, BIRTH_DATE, HAILFROM,ETHNICITY,POLITICAL,TITLE,EDUCATION,EDU_DEGREE,MAJOR_FIRST_TECH_DISCIPLINE,MAJOR_SECOND_TECH_DISCIPLINE,SECONDARY_FIRST_TECH_DISCIPLINE,SECONDARY_SECOND_TECH_DISCIPLINE,EXPERT_TITLE,DOCUMENT_TYPE,DOCUMENT_NUMBER,MOBILE,EMAIL,ADDRESS,POSTALCODE,COMPANY,COMPANY_TYPE,BANK_NAME,BANK_NUMBER,BANK_BRANCH,BANK_BRANCH_PROVINCE,BANK_BRANCH_CITY,MOBILE_ZONE,MOBILE_ZONE_CODE,STATUS)SELECT a.ID, u.USER_ID, a.NAME,CASE a.SEX WHEN '男' THEN 'xbfl,1,' WHEN '女' THEN 'xbfl,2,' ELSE NULL END,a.BIRTH_DATE,a.HAILFROM,eth.CODE AS ETHNICITY,pol.CODE AS POLITICAL,til.CODE AS TITLE,edu.CODE AS EDUCATION,degree.CODE AS EDU_DEGREE,mft.CODE AS MAJOR_FIRST_TECH_DISCIPLINE,mst.CODE AS MAJOR_SECOND_TECH_DISCIPLINE,sft.CODE AS SECONDARY_FIRST_TECH_DISCIPLINE,sst.CODE AS SECONDARY_SECOND_TECH_DISCIPLINE,EXPERT_TITLE,dt.CODE AS DOCUMENT_TYPE, a.DOCUMENT_NUMBER,a.MOBILE,a.EMAIL,a.ADDRESS,a.POSTALCODE,a.COMPANY,ct.CODE AS COMPANY_TYPE,a.BANK_NAME, a.BANK_NUMBER, a.BANK_BRANCH,a.BANK_BRANCH_PROVINCE,a.BANK_BRANCH_CITY,mz.CODE AS MOBILE_ZONE,a.MOBILE_ZONE_CODE,CASE STATUS WHEN '已提交' THEN 20 WHEN '审核未通过' THEN 19 WHEN '审核通过' THEN 30 ELSE 10 END AS STATUSFROM temp_expert_base_info aLEFT JOIN p_un_user_base_info u ON u.USER_ID_CARD_NUMBER = a.DOCUMENT_NUMBER AND u.GROUP_ID=4LEFT JOIN p_data_dictionary eth ON eth.DATA_VALUE = a.ETHNICITY AND eth.CODE LIKE 'mzlb,%'LEFT JOIN p_data_dictionary pol ON pol.DATA_VALUE = a.POLITICAL AND pol.CODE LIKE 'zzmm,%'LEFT JOIN p_data_dictionary til ON til.DATA_VALUE = a.TITLE AND til.CODE LIKE 'dwryzc,%'LEFT JOIN p_data_dictionary edu ON edu.DATA_VALUE = a.EDUCATION AND edu.CODE LIKE 'xlxw,%'LEFT JOIN p_data_dictionary degree ON degree.DATA_VALUE = a.EDU_DEGREE AND degree.CODE LIKE 'byxw,%'LEFT JOIN p_data_dictionary mft ON mft.DATA_VALUE = a.MAJOR_FIRST_TECH_DISCIPLINE AND mft.CODE LIKE 'jslyfl,%' AND mft.LEVEL=2LEFT JOIN p_data_dictionary mst ON mst.DATA_VALUE = a.MAJOR_SECOND_TECH_DISCIPLINE AND mst.CODE LIKE 'jslyfl,%' AND mst.LEVEL=3LEFT JOIN p_data_dictionary sft ON sft.DATA_VALUE = a.SECONDARY_FIRST_TECH_DISCIPLINE AND sft.CODE LIKE 'jslyfl,%' AND sft.LEVEL=2LEFT JOIN p_data_dictionary sst ON sst.DATA_VALUE = a.SECONDARY_SECOND_TECH_DISCIPLINE AND sst.CODE LIKE 'jslyfl,%' AND sst.LEVEL=3LEFT JOIN p_data_dictionary dt ON dt.DATA_VALUE = a.DOCUMENT_TYPE AND dt.CODE LIKE 'sfzjlx,%' LEFT JOIN p_data_dictionary ct ON ct.DATA_VALUE = a.COMPANY_TYPE AND ct.CODE LIKE 'zjdwxz,%' LEFT JOIN p_data_dictionary mz ON mz.DATA_VALUE = a.MOBILE_ZONE AND mz.CODE LIKE 'sjdq,%';#初始化专家教育经历INSERT INTO expert_edu_experience(ID, EXPERT_ID, START_TIME, END_TIME, GRADUATE_SCHOOL, MAJOR, DEGREE)SELECT a.ID, EXPERT_ID, START_TIME, END_TIME, GRADUATE_SCHOOL, MAJOR,CASE WHEN  b.CODE IS NULL THEN 'byxw,5,' ELSE  b.CODE END FROM temp_expert_edu_experience aLEFT JOIN p_data_dictionary b ON a.DEGREE = b.DATA_VALUE AND b.CODE LIKE 'byxw,%' ;#专家专利INSERT INTO expert_patent( ID, EXPERT_ID, PROTECTION_TIME, PATENT_NAME, AUTHORIZED_STATE)SELECT ID, EXPERT_ID, PROTECTION_TIME, PATENT_NAME, AUTHORIZED_STATE FROM temp_expert_patent;#专家担任社会职务INSERT INTO expert_position(ID, EXPERT_ID, START_TIME, END_TIME, GROUP_NAME, `POSITION`)SELECT ID, EXPERT_ID, START_TIME, END_TIME, GROUP_NAME, `POSITION` FROM temp_expert_position;#专家项目经验INSERT INTO expert_project_info(ID, EXPERT_ID, START_TIME, END_TIME, PROJECT_NAME, FUNDSOURCE, EXPENDITURE)SELECT a.ID, a.EXPERT_ID, a.START_TIME, a.END_TIME, a.PROJECT_NAME, b.CODE, a.EXPENDITUREFROM temp_expert_project_info aLEFT JOIN p_data_dictionary b ON a.FUNDSOURCE = b.DATA_VALUE AND b.CODE LIKE 'zjxmjfly,%';#专家论文信息;INSERT INTO expert_represent_papers(ID, EXPERT_ID,PUBLISH_TIME, TITLE, AUTHOR_ORDER)SELECT a.ID, a.EXPERT_ID,a.PUBLISH_TIME, a.TITLE,b.CODE FROM  temp_expert_represent_papers aLEFT JOIN p_data_dictionary b ON a.AUTHOR_ORDER=b.DATA_VALUE AND b.CODE LIKE 'lwzzsx,%';#专家工作经历INSERT INTO expert_work_experience(ID,EXPERT_ID, START_TIME, END_TIME, COMPANY, JOB)SELECT ID,EXPERT_ID, START_TIME, END_TIME, COMPANY, JOB FROM temp_expert_work_experience;#更新专家的头像UPDATE expert_base_info a,temp_expert_photo_mapping b SET a.HEAD_IMAGE = b.FILE_IDWHERE a.ID = b.EXPERT_ID;SELECT * FROM expert_base_info;SELECT * FROM expert_edu_experience;SELECT * FROM expert_patent ;SELECT * FROM expert_position ;SELECT * FROM expert_project_info ;SELECT * FROM expert_represent_papers;SELECT * FROM expert_work_experience;SELECT DEGREE, COUNT(1) FROM temp_expert_edu_experienceGROUP BY DEGREEORDER BY COUNT(1) DESCSELECT * FROM temp_expert_edu_experience aLEFT JOIN p_data_dictionary b ON a.DEGREE = b.DATA_VALUE AND b.CODE LIKE 'byxw,%'WHERE b.CODE IS NULL