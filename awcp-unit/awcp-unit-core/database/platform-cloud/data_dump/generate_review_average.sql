


#批量更新项目的技术专家的评审平均分
CREATE TEMPORARY TABLE tmp_avg
SELECT PROJECT_ID,AVG(CASE WHEN TOTAL_FOR_GQ IS  NULL THEN TOTAL ELSE TOTAL_FOR_GQ END) AS TOTAL ,COUNT(1) AS CNT 
FROM env_review_table
WHERE  REVIEW_TYPE IS NULL AND STATUS=20 AND (IS_AVOID=0 OR IS_AVOID IS NULL)
GROUP BY PROJECT_ID;
UPDATE env_project_base_info a,tmp_avg b
SET a.REVIEW_AVERAGE=b.TOTAL
WHERE a.PROJECT_ID=b.PROJECT_ID AND a.REVIEW_AVERAGE IS NULL;