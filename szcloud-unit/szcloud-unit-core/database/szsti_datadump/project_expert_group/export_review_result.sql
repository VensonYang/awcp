
SELECT p.PROJECT_ID, p.ACCEPT_NUMBER, p.PROJECT_NAME, com.COMPANY_NAME ,IFNULL(ft.DATA_VALUE,p.HIGH_TECH_FIELD) AS HIGH_TECH_FIELD, 
IFNULL(st.DATA_VALUE,p.SUB_HIGH_TECH_FIELD) AS SUB_HIGH_TECH_FIELD,IFNULL(pt.PROJECT_TYPE_NAME,p.PROJECT_TYPE) AS PROJECT_TYPE_NAME, 
pitem.PROJECT_TYPE_NAME AS PLAN_TYPE, p.PRINCIPAL_PERSON,p.CONTACT_PERSON, p.CONTACT_PERSON_MOBILE  ,AVG(rev.TOTAL) AS TOTAL,COUNT(1) AS `COUNT`,
GROUP_CONCAT(CASE WHEN rev.EVALUATION_OPINIONS IS NULL THEn '' ELSE rev.EVALUATION_OPINIONS END  SEPARATOR ' || ') AS REVALUATION_OPINION
FROM project_group_info a
INNER JOIN project_project_group b ON a.ID = b.PROJECT_GROUP_ID INNER JOIN env_project_base_info p ON p.PROJECT_ID = b.PROJECT_ID  
INNER JOIN project_expert_match m ON b.PROJECT_GROUP_ID = m.PROJECT_GROUP_ID 
INNER JOIN expert_group_info eg ON eg.ID = m.EXPERT_GROUP_ID 
LEFT JOIN env_company_base_info com ON com.ID = p.COMPANY_BASE_INFO_ID 
LEFT JOIN p_data_dictionary ft ON ft.CODE = p.HIGH_TECH_FIELD
LEFT JOIN p_data_dictionary st ON st.CODE = p.SUB_HIGH_TECH_FIELD
LEFT JOIN env_system_business_item pt ON pt.ITEM_ID = p.PROJECT_TYPE 
LEFT JOIN env_system_business_item pitem ON pitem.ITEM_ID = pt.PARENT_ID
LEFT JOIN expert_expert_group eeg ON eeg.EXPERT_GROUP_ID = eg.ID
LEFT JOIN env_review_table rev ON rev.EXPERT_ID = eeg.EXPERT_ID AND rev.PROJECT_ID = b.PROJECT_ID 
WHERE 1=1   AND rev.IS_AVOID != 1 
#AND rev.TOTAL IS NOT  NULL 
AND rev.REVIEW_TYPE IS NULL 
AND m.REVIEW_START_TIME >= '2015-05-10' 
#AND  m.REVIEW_START_TIME <= '2015-05-15'  
GROUP BY  p.PROJECT_ID, p.PROJECT_NAME, com.COMPANY_NAME,ft.DATA_VALUE, st.DATA_VALUE,p.CONTACT_PERSON, p.CONTACT_PERSON_MOBILE ORDER BY p.ACCEPT_NUMBER DESC;
